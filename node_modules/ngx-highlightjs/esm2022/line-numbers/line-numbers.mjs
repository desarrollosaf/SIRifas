import { Directive, Input, inject, effect, numberAttribute, booleanAttribute, ElementRef, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { HighlightJS, HighlightBase, HIGHLIGHT_OPTIONS } from 'ngx-highlightjs';
import * as i0 from "@angular/core";
export class HighlightLineNumbers {
    constructor() {
        this._platform = inject(PLATFORM_ID);
        this.options = inject(HIGHLIGHT_OPTIONS)?.lineNumbersOptions;
        this._hljs = inject(HighlightJS);
        this._highlight = inject(HighlightBase);
        this._nativeElement = inject((ElementRef)).nativeElement;
        this.startFrom = this.options?.startFrom;
        this.singleLine = this.options?.singleLine;
        if (isPlatformBrowser(this._platform)) {
            effect(() => {
                if (this._highlight.highlightResult()) {
                    this.addLineNumbers();
                }
            });
        }
    }
    addLineNumbers() {
        // Clean up line numbers observer
        this.destroyLineNumbersObserver();
        requestAnimationFrame(async () => {
            // Add line numbers
            await this._hljs.lineNumbersBlock(this._nativeElement, {
                startFrom: this.startFrom,
                singleLine: this.singleLine
            });
            // If lines count is 1, the line numbers library will not add numbers
            // Observe changes to add 'hljs-line-numbers' class only when line numbers is added to the code element
            this._lineNumbersObs = new MutationObserver(() => {
                if (this._nativeElement.firstElementChild?.tagName.toUpperCase() === 'TABLE') {
                    this._nativeElement.classList.add('hljs-line-numbers');
                }
                this.destroyLineNumbersObserver();
            });
            this._lineNumbersObs.observe(this._nativeElement, { childList: true });
        });
    }
    destroyLineNumbersObserver() {
        if (this._lineNumbersObs) {
            this._lineNumbersObs.disconnect();
            this._lineNumbersObs = null;
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: HighlightLineNumbers, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "16.1.0", version: "18.0.1", type: HighlightLineNumbers, isStandalone: true, selector: "[highlight][lineNumbers], [highlightAuto][lineNumbers]", inputs: { startFrom: ["startFrom", "startFrom", numberAttribute], singleLine: ["singleLine", "singleLine", booleanAttribute] }, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: HighlightLineNumbers, decorators: [{
            type: Directive,
            args: [{
                    standalone: true,
                    selector: '[highlight][lineNumbers], [highlightAuto][lineNumbers]'
                }]
        }], ctorParameters: () => [], propDecorators: { startFrom: [{
                type: Input,
                args: [{ transform: numberAttribute }]
            }], singleLine: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluZS1udW1iZXJzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWhpZ2hsaWdodGpzL2xpbmUtbnVtYmVycy9zcmMvbGluZS1udW1iZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixNQUFNLEVBQ04sZUFBZSxFQUNmLGdCQUFnQixFQUNoQixVQUFVLEVBQ1YsV0FBVyxFQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFzQixNQUFNLGlCQUFpQixDQUFDOztBQU1wRyxNQUFNLE9BQU8sb0JBQW9CO0lBZS9CO1FBYmlCLGNBQVMsR0FBVyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDeEMsWUFBTyxHQUF1QixNQUFNLENBQUMsaUJBQWlCLENBQUMsRUFBRSxrQkFBa0IsQ0FBQztRQUM1RSxVQUFLLEdBQWdCLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN6QyxlQUFVLEdBQWtCLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNsRCxtQkFBYyxHQUFnQixNQUFNLENBQUMsQ0FBQSxVQUF1QixDQUFBLENBQUMsQ0FBQyxhQUFhLENBQUM7UUFLdEQsY0FBUyxHQUFXLElBQUksQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDO1FBRTNDLGVBQVUsR0FBWSxJQUFJLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQztRQUdyRixJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7Z0JBQ1YsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsRUFBRSxFQUFFLENBQUM7b0JBQ3RDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDeEIsQ0FBQztZQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUM7SUFFTyxjQUFjO1FBQ3BCLGlDQUFpQztRQUNqQyxJQUFJLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztRQUNsQyxxQkFBcUIsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUMvQixtQkFBbUI7WUFDbkIsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUU7Z0JBQ3JELFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztnQkFDekIsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO2FBQzVCLENBQUMsQ0FBQztZQUNILHFFQUFxRTtZQUNyRSx1R0FBdUc7WUFDdkcsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLGdCQUFnQixDQUFDLEdBQUcsRUFBRTtnQkFDL0MsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLGlCQUFpQixFQUFFLE9BQU8sQ0FBQyxXQUFXLEVBQUUsS0FBSyxPQUFPLEVBQUUsQ0FBQztvQkFDN0UsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBQ3pELENBQUM7Z0JBQ0QsSUFBSSxDQUFDLDBCQUEwQixFQUFFLENBQUM7WUFDcEMsQ0FBQyxDQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDekUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sMEJBQTBCO1FBQ2hDLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3pCLElBQUksQ0FBQyxlQUFlLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDbEMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFDOUIsQ0FBQztJQUNILENBQUM7OEdBbkRVLG9CQUFvQjtrR0FBcEIsb0JBQW9CLDBJQVdYLGVBQWUsNENBRWYsZ0JBQWdCOzsyRkFiekIsb0JBQW9CO2tCQUpoQyxTQUFTO21CQUFDO29CQUNULFVBQVUsRUFBRSxJQUFJO29CQUNoQixRQUFRLEVBQUUsd0RBQXdEO2lCQUNuRTt3REFZd0MsU0FBUztzQkFBL0MsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUU7Z0JBRUcsVUFBVTtzQkFBakQsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLFxyXG4gIElucHV0LFxyXG4gIGluamVjdCxcclxuICBlZmZlY3QsXHJcbiAgbnVtYmVyQXR0cmlidXRlLFxyXG4gIGJvb2xlYW5BdHRyaWJ1dGUsXHJcbiAgRWxlbWVudFJlZixcclxuICBQTEFURk9STV9JRFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IEhpZ2hsaWdodEpTLCBIaWdobGlnaHRCYXNlLCBISUdITElHSFRfT1BUSU9OUywgTGluZU51bWJlcnNPcHRpb25zIH0gZnJvbSAnbmd4LWhpZ2hsaWdodGpzJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHN0YW5kYWxvbmU6IHRydWUsXHJcbiAgc2VsZWN0b3I6ICdbaGlnaGxpZ2h0XVtsaW5lTnVtYmVyc10sIFtoaWdobGlnaHRBdXRvXVtsaW5lTnVtYmVyc10nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBIaWdobGlnaHRMaW5lTnVtYmVycyB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgX3BsYXRmb3JtOiBvYmplY3QgPSBpbmplY3QoUExBVEZPUk1fSUQpO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgb3B0aW9uczogTGluZU51bWJlcnNPcHRpb25zID0gaW5qZWN0KEhJR0hMSUdIVF9PUFRJT05TKT8ubGluZU51bWJlcnNPcHRpb25zO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2hsanM6IEhpZ2hsaWdodEpTID0gaW5qZWN0KEhpZ2hsaWdodEpTKTtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9oaWdobGlnaHQ6IEhpZ2hsaWdodEJhc2UgPSBpbmplY3QoSGlnaGxpZ2h0QmFzZSk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfbmF0aXZlRWxlbWVudDogSFRNTEVsZW1lbnQgPSBpbmplY3QoRWxlbWVudFJlZjxIVE1MRWxlbWVudD4pLm5hdGl2ZUVsZW1lbnQ7XHJcblxyXG4gIC8vIFRlbXAgb2JzZXJ2ZXIgdG8gb2JzZXJ2ZSB3aGVuIGxpbmUgbnVtYmVycyBoYXMgYmVlbiBhZGRlZCB0byBjb2RlIGVsZW1lbnRcclxuICBwcml2YXRlIF9saW5lTnVtYmVyc09iczogTXV0YXRpb25PYnNlcnZlcjtcclxuXHJcbiAgQElucHV0KHsgdHJhbnNmb3JtOiBudW1iZXJBdHRyaWJ1dGUgfSkgc3RhcnRGcm9tOiBudW1iZXIgPSB0aGlzLm9wdGlvbnM/LnN0YXJ0RnJvbTtcclxuXHJcbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pIHNpbmdsZUxpbmU6IGJvb2xlYW4gPSB0aGlzLm9wdGlvbnM/LnNpbmdsZUxpbmU7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMuX3BsYXRmb3JtKSkge1xyXG4gICAgICBlZmZlY3QoKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLl9oaWdobGlnaHQuaGlnaGxpZ2h0UmVzdWx0KCkpIHtcclxuICAgICAgICAgIHRoaXMuYWRkTGluZU51bWJlcnMoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGRMaW5lTnVtYmVycygpOiB2b2lkIHtcclxuICAgIC8vIENsZWFuIHVwIGxpbmUgbnVtYmVycyBvYnNlcnZlclxyXG4gICAgdGhpcy5kZXN0cm95TGluZU51bWJlcnNPYnNlcnZlcigpO1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQWRkIGxpbmUgbnVtYmVyc1xyXG4gICAgICBhd2FpdCB0aGlzLl9obGpzLmxpbmVOdW1iZXJzQmxvY2sodGhpcy5fbmF0aXZlRWxlbWVudCwge1xyXG4gICAgICAgIHN0YXJ0RnJvbTogdGhpcy5zdGFydEZyb20sXHJcbiAgICAgICAgc2luZ2xlTGluZTogdGhpcy5zaW5nbGVMaW5lXHJcbiAgICAgIH0pO1xyXG4gICAgICAvLyBJZiBsaW5lcyBjb3VudCBpcyAxLCB0aGUgbGluZSBudW1iZXJzIGxpYnJhcnkgd2lsbCBub3QgYWRkIG51bWJlcnNcclxuICAgICAgLy8gT2JzZXJ2ZSBjaGFuZ2VzIHRvIGFkZCAnaGxqcy1saW5lLW51bWJlcnMnIGNsYXNzIG9ubHkgd2hlbiBsaW5lIG51bWJlcnMgaXMgYWRkZWQgdG8gdGhlIGNvZGUgZWxlbWVudFxyXG4gICAgICB0aGlzLl9saW5lTnVtYmVyc09icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5fbmF0aXZlRWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZD8udGFnTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnVEFCTEUnKSB7XHJcbiAgICAgICAgICB0aGlzLl9uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hsanMtbGluZS1udW1iZXJzJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZGVzdHJveUxpbmVOdW1iZXJzT2JzZXJ2ZXIoKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuX2xpbmVOdW1iZXJzT2JzLm9ic2VydmUodGhpcy5fbmF0aXZlRWxlbWVudCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVzdHJveUxpbmVOdW1iZXJzT2JzZXJ2ZXIoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5fbGluZU51bWJlcnNPYnMpIHtcclxuICAgICAgdGhpcy5fbGluZU51bWJlcnNPYnMuZGlzY29ubmVjdCgpO1xyXG4gICAgICB0aGlzLl9saW5lTnVtYmVyc09icyA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==