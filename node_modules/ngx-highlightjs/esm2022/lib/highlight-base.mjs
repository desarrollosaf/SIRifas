import { Directive, inject, effect, ElementRef, SecurityContext, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { DomSanitizer } from '@angular/platform-browser';
import { HighlightJS } from './highlight.service';
import { trustedHTMLFromStringBypass } from './trusted-types';
import * as i0 from "@angular/core";
export class HighlightBase {
    constructor() {
        this._hljs = inject(HighlightJS);
        this._nativeElement = inject((ElementRef)).nativeElement;
        this._sanitizer = inject(DomSanitizer);
        this._platform = inject(PLATFORM_ID);
        if (isPlatformBrowser(this._platform)) {
            effect(() => {
                const code = this.code();
                // Set code text before highlighting
                this.setTextContent(code || '');
                if (code) {
                    this.highlightElement(code);
                }
            });
            effect(() => {
                const res = this.highlightResult();
                this.setInnerHTML(res?.value);
                // Forward highlight response to the highlighted output
                this.highlighted.emit(res);
            });
        }
    }
    setTextContent(content) {
        requestAnimationFrame(() => this._nativeElement.textContent = content);
    }
    setInnerHTML(content) {
        requestAnimationFrame(() => this._nativeElement.innerHTML = trustedHTMLFromStringBypass(this._sanitizer.sanitize(SecurityContext.HTML, content) || ''));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: HighlightBase, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "18.0.1", type: HighlightBase, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: HighlightBase, decorators: [{
            type: Directive
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlnaGxpZ2h0LWJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtaGlnaGxpZ2h0anMvc3JjL2xpYi9oaWdobGlnaHQtYmFzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixNQUFNLEVBQ04sVUFBVSxFQUdWLGVBQWUsRUFFZixXQUFXLEVBQ1osTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRXpELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7QUFHOUQsTUFBTSxPQUFnQixhQUFhO0lBa0JqQztRQWhCVSxVQUFLLEdBQWdCLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUVsQyxtQkFBYyxHQUFnQixNQUFNLENBQUMsQ0FBQSxVQUF1QixDQUFBLENBQUMsQ0FBQyxhQUFhLENBQUM7UUFDckYsZUFBVSxHQUFpQixNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDaEQsY0FBUyxHQUFXLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQWE5QyxJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7Z0JBQ1YsTUFBTSxJQUFJLEdBQVcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNqQyxvQ0FBb0M7Z0JBQ3BDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUNoQyxJQUFJLElBQUksRUFBRSxDQUFDO29CQUNULElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDOUIsQ0FBQztZQUNILENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLEdBQUcsRUFBRTtnQkFDVixNQUFNLEdBQUcsR0FBd0IsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUN4RCxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDOUIsdURBQXVEO2dCQUN2RCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM3QixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDO0lBSU8sY0FBYyxDQUFDLE9BQWU7UUFDcEMscUJBQXFCLENBQUMsR0FBRyxFQUFFLENBQ3pCLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FDMUMsQ0FBQztJQUNKLENBQUM7SUFFTyxZQUFZLENBQUMsT0FBc0I7UUFDekMscUJBQXFCLENBQUMsR0FBRyxFQUFFLENBQ3pCLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxHQUFHLDJCQUEyQixDQUN6RCxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FDOUQsQ0FDRixDQUFDO0lBQ0osQ0FBQzs4R0FwRG1CLGFBQWE7a0dBQWIsYUFBYTs7MkZBQWIsYUFBYTtrQkFEbEMsU0FBUyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLFxyXG4gIGluamVjdCxcclxuICBlZmZlY3QsXHJcbiAgRWxlbWVudFJlZixcclxuICBJbnB1dFNpZ25hbCxcclxuICBXcml0YWJsZVNpZ25hbCxcclxuICBTZWN1cml0eUNvbnRleHQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIFBMQVRGT1JNX0lEXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcbmltcG9ydCB0eXBlIHsgQXV0b0hpZ2hsaWdodFJlc3VsdCwgSGlnaGxpZ2h0UmVzdWx0IH0gZnJvbSAnaGlnaGxpZ2h0LmpzJztcclxuaW1wb3J0IHsgSGlnaGxpZ2h0SlMgfSBmcm9tICcuL2hpZ2hsaWdodC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgdHJ1c3RlZEhUTUxGcm9tU3RyaW5nQnlwYXNzIH0gZnJvbSAnLi90cnVzdGVkLXR5cGVzJztcclxuXHJcbkBEaXJlY3RpdmUoKVxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgSGlnaGxpZ2h0QmFzZSB7XHJcblxyXG4gIHByb3RlY3RlZCBfaGxqczogSGlnaGxpZ2h0SlMgPSBpbmplY3QoSGlnaGxpZ2h0SlMpO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9uYXRpdmVFbGVtZW50OiBIVE1MRWxlbWVudCA9IGluamVjdChFbGVtZW50UmVmPEhUTUxFbGVtZW50PikubmF0aXZlRWxlbWVudDtcclxuICBwcml2YXRlIF9zYW5pdGl6ZXI6IERvbVNhbml0aXplciA9IGluamVjdChEb21TYW5pdGl6ZXIpO1xyXG4gIHByaXZhdGUgX3BsYXRmb3JtOiBvYmplY3QgPSBpbmplY3QoUExBVEZPUk1fSUQpO1xyXG5cclxuICAvLyBDb2RlIHRvIGhpZ2hsaWdodFxyXG4gIGFic3RyYWN0IGNvZGU6IElucHV0U2lnbmFsPHN0cmluZz47XHJcblxyXG4gIC8vIEhpZ2hsaWdodGVkIHJlc3VsdFxyXG4gIGFic3RyYWN0IGhpZ2hsaWdodFJlc3VsdDogV3JpdGFibGVTaWduYWw8SGlnaGxpZ2h0UmVzdWx0IHwgQXV0b0hpZ2hsaWdodFJlc3VsdD47XHJcblxyXG4gIC8vIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gY29kZSBzdHJpbmcgaXMgaGlnaGxpZ2h0ZWRcclxuICBhYnN0cmFjdCBoaWdobGlnaHRlZDogRXZlbnRFbWl0dGVyPEhpZ2hsaWdodFJlc3VsdCB8IEF1dG9IaWdobGlnaHRSZXN1bHQ+O1xyXG5cclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5fcGxhdGZvcm0pKSB7XHJcbiAgICAgIGVmZmVjdCgoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY29kZTogc3RyaW5nID0gdGhpcy5jb2RlKCk7XHJcbiAgICAgICAgLy8gU2V0IGNvZGUgdGV4dCBiZWZvcmUgaGlnaGxpZ2h0aW5nXHJcbiAgICAgICAgdGhpcy5zZXRUZXh0Q29udGVudChjb2RlIHx8ICcnKTtcclxuICAgICAgICBpZiAoY29kZSkge1xyXG4gICAgICAgICAgdGhpcy5oaWdobGlnaHRFbGVtZW50KGNvZGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBlZmZlY3QoKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlczogQXV0b0hpZ2hsaWdodFJlc3VsdCA9IHRoaXMuaGlnaGxpZ2h0UmVzdWx0KCk7XHJcbiAgICAgICAgdGhpcy5zZXRJbm5lckhUTUwocmVzPy52YWx1ZSk7XHJcbiAgICAgICAgLy8gRm9yd2FyZCBoaWdobGlnaHQgcmVzcG9uc2UgdG8gdGhlIGhpZ2hsaWdodGVkIG91dHB1dFxyXG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWQuZW1pdChyZXMpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBoaWdobGlnaHRFbGVtZW50KGNvZGU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gO1xyXG5cclxuICBwcml2YXRlIHNldFRleHRDb250ZW50KGNvbnRlbnQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+XHJcbiAgICAgIHRoaXMuX25hdGl2ZUVsZW1lbnQudGV4dENvbnRlbnQgPSBjb250ZW50XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRJbm5lckhUTUwoY29udGVudDogc3RyaW5nIHwgbnVsbCk6IHZvaWQge1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+XHJcbiAgICAgIHRoaXMuX25hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gdHJ1c3RlZEhUTUxGcm9tU3RyaW5nQnlwYXNzKFxyXG4gICAgICAgIHRoaXMuX3Nhbml0aXplci5zYW5pdGl6ZShTZWN1cml0eUNvbnRleHQuSFRNTCwgY29udGVudCkgfHwgJydcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl19