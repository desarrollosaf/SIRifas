import { Directive, Input, inject, effect, contentChild } from '@angular/core';
import { Platform } from '@angular/cdk/platform';
import { CdkVirtualScrollViewport } from '@angular/cdk/scrolling';
import { NgScrollbarExt } from 'ngx-scrollbar';
import * as i0 from "@angular/core";
export class NgScrollbarCdkVirtualScroll {
    constructor() {
        this.scrollbar = inject(NgScrollbarExt, { self: true });
        this.platform = inject(Platform);
        this.virtualScrollViewportRef = contentChild(CdkVirtualScrollViewport);
        this.scrollbar.externalViewport = '.cdk-virtual-scroll-viewport';
        this.scrollbar.externalContentWrapper = '.cdk-virtual-scroll-content-wrapper';
        this.scrollbar.externalSpacer = '.cdk-virtual-scroll-spacer';
        effect((onCleanup) => {
            // If content width is bigger than the viewport, we need to update the spacer width to display horizontal scrollbar
            let resizeObserver;
            const virtualScrollViewport = this.virtualScrollViewportRef();
            const spacer = virtualScrollViewport.elementRef.nativeElement.querySelector(this.scrollbar.externalSpacer);
            if (this.platform.isBrowser && virtualScrollViewport) {
                resizeObserver = new ResizeObserver((entries) => {
                    entries.forEach((entry) => {
                        if (virtualScrollViewport.orientation === 'vertical') {
                            spacer.style.setProperty('width', `${entry.contentRect.width}px`);
                        }
                        else {
                            spacer.style.setProperty('height', `${entry.contentRect.height}px`);
                        }
                    });
                    // Disconnect after first change if directive is not set to auto
                    if (this.cdkVirtualScrollViewport !== 'auto') {
                        resizeObserver.disconnect();
                    }
                    // Observe content wrapper for size changes
                    resizeObserver.observe(virtualScrollViewport._contentWrapper.nativeElement);
                });
            }
            onCleanup(() => resizeObserver?.disconnect());
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.1", ngImport: i0, type: NgScrollbarCdkVirtualScroll, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "17.2.0", version: "18.2.1", type: NgScrollbarCdkVirtualScroll, isStandalone: true, selector: "ng-scrollbar[cdkVirtualScrollViewport]", inputs: { cdkVirtualScrollViewport: "cdkVirtualScrollViewport" }, queries: [{ propertyName: "virtualScrollViewportRef", first: true, predicate: CdkVirtualScrollViewport, descendants: true, isSignal: true }], ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.1", ngImport: i0, type: NgScrollbarCdkVirtualScroll, decorators: [{
            type: Directive,
            args: [{
                    standalone: true,
                    selector: 'ng-scrollbar[cdkVirtualScrollViewport]'
                }]
        }], ctorParameters: () => [], propDecorators: { cdkVirtualScrollViewport: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrLXZpcnR1YWwtc2Nyb2xsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXNjcm9sbGJhci9jZGsvc3JjL2Nkay12aXJ0dWFsLXNjcm9sbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLFlBQVksRUFHYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFNL0MsTUFBTSxPQUFPLDJCQUEyQjtJQVV0QztRQVJpQixjQUFTLEdBQW1CLE1BQU0sQ0FBQyxjQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUVuRSxhQUFRLEdBQWEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRXRDLDZCQUF3QixHQUFxQyxZQUFZLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUtuSCxJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixHQUFHLDhCQUE4QixDQUFDO1FBQ2pFLElBQUksQ0FBQyxTQUFTLENBQUMsc0JBQXNCLEdBQUcscUNBQXFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFjLEdBQUcsNEJBQTRCLENBQUM7UUFFN0QsTUFBTSxDQUFDLENBQUMsU0FBa0MsRUFBRSxFQUFFO1lBQzVDLG1IQUFtSDtZQUNuSCxJQUFJLGNBQThCLENBQUM7WUFDbkMsTUFBTSxxQkFBcUIsR0FBNkIsSUFBSSxDQUFDLHdCQUF3QixFQUFFLENBQUM7WUFFeEYsTUFBTSxNQUFNLEdBQWdCLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUM7WUFFeEgsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsSUFBSSxxQkFBcUIsRUFBRSxDQUFDO2dCQUNyRCxjQUFjLEdBQUcsSUFBSSxjQUFjLENBQUMsQ0FBQyxPQUE4QixFQUFFLEVBQUU7b0JBQ3JFLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUEwQixFQUFFLEVBQUU7d0JBQzdDLElBQUkscUJBQXFCLENBQUMsV0FBVyxLQUFLLFVBQVUsRUFBRSxDQUFDOzRCQUNyRCxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsR0FBSSxLQUFLLENBQUMsV0FBVyxDQUFDLEtBQU0sSUFBSSxDQUFDLENBQUM7d0JBQ3RFLENBQUM7NkJBQU0sQ0FBQzs0QkFDTixNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxRQUFRLEVBQUUsR0FBSSxLQUFLLENBQUMsV0FBVyxDQUFDLE1BQU8sSUFBSSxDQUFDLENBQUM7d0JBQ3hFLENBQUM7b0JBQ0gsQ0FBQyxDQUFDLENBQUM7b0JBRUgsZ0VBQWdFO29CQUNoRSxJQUFJLElBQUksQ0FBQyx3QkFBd0IsS0FBSyxNQUFNLEVBQUUsQ0FBQzt3QkFDN0MsY0FBYyxDQUFDLFVBQVUsRUFBRSxDQUFDO29CQUM5QixDQUFDO29CQUNELDJDQUEyQztvQkFDM0MsY0FBYyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQzlFLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxjQUFjLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7OEdBM0NVLDJCQUEyQjtrR0FBM0IsMkJBQTJCLDBOQU1xRCx3QkFBd0I7OzJGQU54RywyQkFBMkI7a0JBSnZDLFNBQVM7bUJBQUM7b0JBQ1QsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLFFBQVEsRUFBRSx3Q0FBd0M7aUJBQ25EO3dEQVNVLHdCQUF3QjtzQkFBaEMsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLFxyXG4gIElucHV0LFxyXG4gIGluamVjdCxcclxuICBlZmZlY3QsXHJcbiAgY29udGVudENoaWxkLFxyXG4gIFNpZ25hbCxcclxuICBFZmZlY3RDbGVhbnVwUmVnaXN0ZXJGblxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBQbGF0Zm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wbGF0Zm9ybSc7XHJcbmltcG9ydCB7IENka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9zY3JvbGxpbmcnO1xyXG5pbXBvcnQgeyBOZ1Njcm9sbGJhckV4dCB9IGZyb20gJ25neC1zY3JvbGxiYXInO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcclxuICBzZWxlY3RvcjogJ25nLXNjcm9sbGJhcltjZGtWaXJ0dWFsU2Nyb2xsVmlld3BvcnRdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgTmdTY3JvbGxiYXJDZGtWaXJ0dWFsU2Nyb2xsIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBzY3JvbGxiYXI6IE5nU2Nyb2xsYmFyRXh0ID0gaW5qZWN0KE5nU2Nyb2xsYmFyRXh0LCB7IHNlbGY6IHRydWUgfSk7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGxhdGZvcm06IFBsYXRmb3JtID0gaW5qZWN0KFBsYXRmb3JtKTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSB2aXJ0dWFsU2Nyb2xsVmlld3BvcnRSZWY6IFNpZ25hbDxDZGtWaXJ0dWFsU2Nyb2xsVmlld3BvcnQ+ID0gY29udGVudENoaWxkKENka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydCk7XHJcblxyXG4gIEBJbnB1dCgpIGNka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydDogJycgfCAnYXV0byc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5zY3JvbGxiYXIuZXh0ZXJuYWxWaWV3cG9ydCA9ICcuY2RrLXZpcnR1YWwtc2Nyb2xsLXZpZXdwb3J0JztcclxuICAgIHRoaXMuc2Nyb2xsYmFyLmV4dGVybmFsQ29udGVudFdyYXBwZXIgPSAnLmNkay12aXJ0dWFsLXNjcm9sbC1jb250ZW50LXdyYXBwZXInO1xyXG4gICAgdGhpcy5zY3JvbGxiYXIuZXh0ZXJuYWxTcGFjZXIgPSAnLmNkay12aXJ0dWFsLXNjcm9sbC1zcGFjZXInO1xyXG5cclxuICAgIGVmZmVjdCgob25DbGVhbnVwOiBFZmZlY3RDbGVhbnVwUmVnaXN0ZXJGbikgPT4ge1xyXG4gICAgICAvLyBJZiBjb250ZW50IHdpZHRoIGlzIGJpZ2dlciB0aGFuIHRoZSB2aWV3cG9ydCwgd2UgbmVlZCB0byB1cGRhdGUgdGhlIHNwYWNlciB3aWR0aCB0byBkaXNwbGF5IGhvcml6b250YWwgc2Nyb2xsYmFyXHJcbiAgICAgIGxldCByZXNpemVPYnNlcnZlcjogUmVzaXplT2JzZXJ2ZXI7XHJcbiAgICAgIGNvbnN0IHZpcnR1YWxTY3JvbGxWaWV3cG9ydDogQ2RrVmlydHVhbFNjcm9sbFZpZXdwb3J0ID0gdGhpcy52aXJ0dWFsU2Nyb2xsVmlld3BvcnRSZWYoKTtcclxuXHJcbiAgICAgIGNvbnN0IHNwYWNlcjogSFRNTEVsZW1lbnQgPSB2aXJ0dWFsU2Nyb2xsVmlld3BvcnQuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5zY3JvbGxiYXIuZXh0ZXJuYWxTcGFjZXIpO1xyXG5cclxuICAgICAgaWYgKHRoaXMucGxhdGZvcm0uaXNCcm93c2VyICYmIHZpcnR1YWxTY3JvbGxWaWV3cG9ydCkge1xyXG4gICAgICAgIHJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzOiBSZXNpemVPYnNlcnZlckVudHJ5W10pID0+IHtcclxuICAgICAgICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnk6IFJlc2l6ZU9ic2VydmVyRW50cnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHZpcnR1YWxTY3JvbGxWaWV3cG9ydC5vcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJykge1xyXG4gICAgICAgICAgICAgIHNwYWNlci5zdHlsZS5zZXRQcm9wZXJ0eSgnd2lkdGgnLCBgJHsgZW50cnkuY29udGVudFJlY3Qud2lkdGggfXB4YCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgc3BhY2VyLnN0eWxlLnNldFByb3BlcnR5KCdoZWlnaHQnLCBgJHsgZW50cnkuY29udGVudFJlY3QuaGVpZ2h0IH1weGApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAvLyBEaXNjb25uZWN0IGFmdGVyIGZpcnN0IGNoYW5nZSBpZiBkaXJlY3RpdmUgaXMgbm90IHNldCB0byBhdXRvXHJcbiAgICAgICAgICBpZiAodGhpcy5jZGtWaXJ0dWFsU2Nyb2xsVmlld3BvcnQgIT09ICdhdXRvJykge1xyXG4gICAgICAgICAgICByZXNpemVPYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyBPYnNlcnZlIGNvbnRlbnQgd3JhcHBlciBmb3Igc2l6ZSBjaGFuZ2VzXHJcbiAgICAgICAgICByZXNpemVPYnNlcnZlci5vYnNlcnZlKHZpcnR1YWxTY3JvbGxWaWV3cG9ydC5fY29udGVudFdyYXBwZXIubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG9uQ2xlYW51cCgoKSA9PiByZXNpemVPYnNlcnZlcj8uZGlzY29ubmVjdCgpKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXX0=